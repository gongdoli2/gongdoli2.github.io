<!-- -&#45;&#45;-->
<!--import SideBar from "../../layouts/SideBar.astro";-->
<!--import "../../styles/school.css";-->
<!-- -&#45;&#45;-->

<!--<SideBar/>-->

<!--<div class="container">-->
<!--    <h1 class="page-title">오늘의 급식</h1>-->
<!--    <h2 class="current-date"></h2>-->

<!--    <section class="card">-->
<!--        <div class="card-box" id="meal-box">급식을 불러오는 중..</div>-->
<!--        <div class="buttons" id="meal-buttons">-->
<!--            <button data-meal="1">조식</button>-->
<!--            <button data-meal="2" class="active">중식</button>-->
<!--            <button data-meal="3">석식</button>-->
<!--        </div>-->
<!--    </section>-->

<!--    <section class="card">-->
<!--        <div class="card-box" id="cal-box">칼로리를 불러오는 중...</div>-->
<!--    </section>-->

<!--    <section class="card">-->
<!--        <div class="card-box" id="nut-box">영양정보를 불러오는 중...</div>-->
<!--    </section>-->
<!--</div>-->

<!--<script>-->
<!--    import { loadMeal } from "../../utils/mealApp.ts";-->
<!--    import { formatDate } from "../../utils/dateUtils.ts";-->

<!--    const nowElement = document.querySelector(".current-date");-->
<!--    if (nowElement) nowElement.textContent = formatDate();-->

<!--    document.addEventListener("DOMContentLoaded", async () => {-->
<!--        const mealDiv = document.getElementById("meal-box");-->
<!--        const calDiv = document.getElementById("cal-box");-->
<!--        const nutDiv = document.getElementById("nut-box");-->
<!--        const mealButtonsContainer = document.getElementById("meal-buttons");-->
<!--        const mealButtons = mealButtonsContainer?.querySelectorAll("button") ?? [];-->

<!--        const messages = {-->
<!--            loading: {-->
<!--                meal: "급식을 불러오는 중...",-->
<!--                cal: "칼로리를 불러오는 중...",-->
<!--                nut: "영양정보를 불러오는 중..."-->
<!--            },-->
<!--            empty: "오늘은 급식이 없습니다."-->
<!--        };-->

<!--        const calSection = calDiv?.parentElement;-->
<!--        const nutSection = nutDiv?.parentElement;-->

<!--        function setState(state: "loading" | "empty" | "normal") {-->
<!--            const showSections = state !== "empty";-->

<!--            if (mealButtonsContainer) mealButtonsContainer.style.display = showSections ? "flex" : "none";-->
<!--            if (calSection) calSection.style.display = showSections ? "block" : "none";-->
<!--            if (nutSection) nutSection.style.display = showSections ? "block" : "none";-->

<!--            if (!mealDiv || !calDiv || !nutDiv) return;-->

<!--            if (state === "empty") {-->
<!--                mealDiv.innerHTML = `${messages.empty}`;-->
<!--                calDiv.innerHTML = "";-->
<!--                nutDiv.innerHTML = "";-->
<!--            } else if (state === "loading") {-->
<!--                mealDiv.textContent = messages.loading.meal;-->
<!--                calDiv.textContent = messages.loading.cal;-->
<!--                nutDiv.textContent = messages.loading.nut;-->
<!--            }-->
<!--        }-->

<!--        function renderSection(title: string, content: string | string[]): string {-->
<!--            const items = Array.isArray(content)-->
<!--                ? content.map(d => `<div class="section-item">${d}</div>`).join("")-->
<!--                : `<div class="section-item">${content}</div>`;-->

<!--            return `<div><div class="section-title">${title}</div>${items}</div>`;-->
<!--        }-->

<!--        async function renderMeal(mealType = "2") {-->
<!--            setState("loading");-->

<!--            const mealData = await loadMeal(mealType);-->

<!--            if (!mealData || !mealData.dishes?.length) {-->
<!--                setState("empty");-->
<!--                return;-->
<!--            }-->

<!--            if (mealDiv && calDiv && nutDiv) {-->
<!--                mealDiv.innerHTML = `<div class="card-box">${renderSection("급식", mealData.dishes)}</div>`;-->
<!--                calDiv.innerHTML = `<div class="card-box">${renderSection("칼로리", mealData.cal)}</div>`;-->
<!--                nutDiv.innerHTML = `<div class="card-box">${renderSection("영양정보", mealData.nutrition)}</div>`;-->
<!--            }-->

<!--            setState("normal");-->
<!--        }-->

<!--        mealButtons.forEach(btn => {-->
<!--            btn.addEventListener("click", () => {-->
<!--                mealButtons.forEach(b => b.classList.remove("active"));-->
<!--                btn.classList.add("active");-->

<!--                renderMeal(btn.dataset.meal ?? "2");-->
<!--                if (nowElement) nowElement.textContent = formatDate();-->
<!--            });-->
<!--        });-->

<!--        await renderMeal("2");-->
<!--    });-->
<!--</script>-->

---
import "../../styles/school.css";
import SideBar from "../../layouts/SideBar.astro";
---
<SideBar/>

<div class="container">
    <h1 class="page-title">오늘의 급식</h1>
    <h2 class="current-date" id="currentDate"></h2>

    <section class="card">
        <div class="card-box" id="meal-box">급식을 불러오는 중...</div>
        <div class="buttons" id="meal-buttons" role="tablist">
            <button data-meal="1">조식</button>
            <button data-meal="2" class="active">중식</button>
            <button data-meal="3">석식</button>
        </div>
    </section>

    <section class="card">
        <div class="card-box" id="cal-box">칼로리를 불러오는 중...</div>
    </section>

    <section class="card">
        <div class="card-box" id="nut-box">영양정보를 불러오는 중...</div>
    </section>
</div>

<script type="module">
    import { loadMeal } from "../utils/mealApp.js";
    import { formatDate } from "../utils/dateUtils.js";

    const nowEl = document.getElementById("currentDate");
    nowEl.textContent = formatDate();

    const mealBox = document.getElementById("meal-box");
    const calBox = document.getElementById("cal-box");
    const nutBox = document.getElementById("nut-box");
    const buttonsWrap = document.getElementById("meal-buttons");
    const buttons = Array.from(buttonsWrap.querySelectorAll("button"));

    function setLoading() {
        mealBox.textContent = "급식을 불러오는 중...";
        calBox.textContent = "칼로리를 불러오는 중...";
        nutBox.textContent = "영양정보를 불러오는 중...";
    }
    function setEmpty() {
        mealBox.textContent = "오늘은 급식이 없습니다.";
        calBox.textContent = "";
        nutBox.textContent = "";
    }

    function renderSection(title, content) {
        const items = Array.isArray(content) ? content.map(i => `<div class="section-item">${i}</div>`).join("") : `<div class="section-item">${content}</div>`;
        return `<div><div class="section-title">${title}</div>${items}</div>`;
    }

    async function render(mealType="2") {
        setLoading();
        const data = await loadMeal(mealType);
        if (!data || !data.dishes.length) { setEmpty(); return; }

        mealBox.innerHTML = renderSection("급식", data.dishes);
        calBox.innerHTML = renderSection("칼로리", data.cal);
        nutBox.innerHTML = renderSection("영양정보", data.nutrition);
    }

    buttons.forEach(btn => {
        btn.addEventListener("click", async () => {
            buttons.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            await render(btn.dataset.meal ?? "2");
        });
    });

    // 초기 렌더
    render("2");
</script>
