---
import "../../styles/lotto.css";
import SideBar from "../../layouts/SideBar.astro";
---

<SideBar />

<div class="container">
    <h1 class="page-title">ğŸ° ë¡œë˜ ì°¸ê°€ì ë¦¬ìŠ¤íŠ¸</h1>

    <div id="count-badge" style="display:none;">
        í˜„ì¬ <span id="total-count">0</span>ëª…ì´ ì°¸ê°€ ì¤‘ì…ë‹ˆë‹¤
    </div>

    <div id="list-container">
        <p id="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        <table id="lotto-table" style="display:none;">
            <thead>
            <tr>
                <th>ì„±ëª…</th>
                <th>ID</th>
                <th>ë²ˆí˜¸</th>
            </tr>
            </thead>
            <tbody id="lotto-tbody"></tbody>
        </table>
    </div>
</div>

<script type="module">
    document.addEventListener("DOMContentLoaded", async () => {
        const tbody = document.getElementById("lotto-tbody");
        const table = document.getElementById("lotto-table");
        const loadingText = document.getElementById("loading-text");
        const countBadge = document.getElementById("count-badge");
        const totalCount = document.getElementById("total-count");

        try {
            const res = await fetch("/api/lotto/list");
            if (!res.ok) throw new Error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

            const entries = await res.json();

            // ì¸ì›ìˆ˜ ì—…ë°ì´íŠ¸
            totalCount.textContent = entries.length;
            countBadge.style.display = "block";

            if (entries.length === 0) {
                loadingText.textContent = "ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤.";
                return;
            }

            // tbody ì±„ìš°ê¸°
            entries.forEach(entry => {
                const tr = document.createElement("tr");
                const numbers = entry.numbers.join(" ");
                tr.innerHTML = `
          <td>${entry.name}</td>
          <td>${entry.studentId}</td>
          <td class="numbers">${numbers}</td>
        `;
                tbody.appendChild(tr);
            });

            // í…Œì´ë¸” ë³´ì—¬ì£¼ê¸°
            loadingText.style.display = "none";
            table.style.display = "table";
        } catch (err) {
            console.error(err);
            loadingText.textContent = "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        }
    });
</script>