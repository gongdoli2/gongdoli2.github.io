---
import "../../styles/lotto.css";
import SideBar from "../../layouts/SideBar.astro";
---

<SideBar />

<div class="container">
    <h1 class="page-title">ğŸ° ë¡œë˜ ì°¸ê°€ì ë¦¬ìŠ¤íŠ¸</h1>

    <div id="list-container">
        <p id="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        <table id="lotto-table" style="display:none;">
            <thead>
            <tr>
                <th>ì„±ëª…</th>
                <th>í•™ë²ˆ</th>
                <th>ë²ˆí˜¸</th>
            </tr>
            </thead>
            <tbody id="lotto-tbody"></tbody>
        </table>
    </div>
</div>

<script type="module">
    document.addEventListener("DOMContentLoaded", async () => {
        const tbody = document.getElementById("lotto-tbody");
        const table = document.getElementById("lotto-table");
        const loadingText = document.getElementById("loading-text");

        try {
            const res = await fetch("/api/lotto/list");
            if (!res.ok) throw new Error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

            const entries = await res.json();
            if (entries.length === 0) {
                loadingText.textContent = "ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤.";
                return;
            }

            // tbody ì±„ìš°ê¸°
            entries.forEach(entry => {
                const tr = document.createElement("tr");
                const numbers = entry.numbers.join(" ");
                tr.innerHTML = `
          <td>${entry.name}</td>
          <td>${entry.studentId}</td>
          <td class="numbers">${numbers}</td>
        `;
                tbody.appendChild(tr);
            });

            // í…Œì´ë¸” ë³´ì—¬ì£¼ê¸°
            loadingText.style.display = "none";
            table.style.display = "table";
        } catch (err) {
            console.error(err);
            loadingText.textContent = "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        }
    });
</script>

<style>
    .container {
        padding: 2rem;
        text-align: center;
        color: #fff;
    }

    table {
        width: 100%;
        max-width: 600px;
        margin: 1rem auto;
        border-collapse: collapse;
        background-color: #2a2448;
        border-radius: 12px;
        overflow: hidden;
    }

    th, td {
        padding: 0.8rem 1rem;
        text-align: center;
    }

    th {
        background-color: #3a2f5c;
    }

    tr:nth-child(even) {
        background-color: #352f65;
    }

    .numbers {
        letter-spacing: 0.2rem;
    }

    #loading-text {
        margin-top: 1rem;
        color: #a291ff;
        font-weight: 600;
    }
</style>
